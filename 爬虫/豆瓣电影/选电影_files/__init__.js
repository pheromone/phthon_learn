jQuery.fn.isChildAndSelfOf=function(t){return this.closest(t).length>0},function(t){function e(t){function e(t){t.preventDefault();var e=$(t.target),a=e.data("type");"tv"===a?A.find(".custom-btn").hide():A.find(".custom-btn").show(),D.find("[name=type]").val(a),e.addClass("activate"),e.siblings(".activate").removeClass("activate"),s({type:a})}function a(t){var e=$(t.target),a=e.siblings(".custom-frm");a.addClass("inline-block").find("input").focus(),e.hide()}function n(t){t.preventDefault();var e=$(t.target),a=e.parents(".custom-frm"),n=a.find("input"),i=$.trim(n.val()),s=a.data("type");if(i){var c;tagHtml=$(I({val:i,type:a.data("type"),custom:!0})),"tag"===s?c=tagHtml.appendTo(F):"sub_tag"===s&&(c=tagHtml.appendTo(M)),o(c.find("input")),n.val("")}a.removeClass("inline-block").siblings(".custom-btn").show()}function i(t){t.preventDefault();var e=$(t.target).parent("label"),a=e.parent().find("input:first");e.hasClass("activate")&&o(a),e.remove()}function o(e){var a=e.parents(".tag-list, .sub-tag-list"),n=D.find("[name=type]").val(),i=e.attr("name");if("pending"==T.state()&&T.abort(),A.find("[name=page_start]").val(0),S.empty(),a.length&&(a.find(".activate").removeClass("activate").find("[checked]").removeAttr("checked"),e.attr("checked","checked").parent("label").addClass("activate")),"tag"===i){switch(e.val()){case"最新全片":A.find("[name=sort][value=rank]").parent().show(),A.find("[name=sort][value=time]").attr("checked","checked");break;case"最新":A.find("[name=sort][value=rank]").parent().show(),A.find("[name=sort][value=time]").attr("checked","checked"),A.find("[name=sort]").attr("disabled","disabled");break;case"豆瓣猜":A.find("[name=sort][value=rank]").parent().hide();break;default:A.find("[name=sort][value=rank]").parent().show(),A.find("[name=sort]").removeAttr("disabled"),t.hashbang||A.find("[name=sort][value=recommend]").attr("checked","checked")}s({type:n,tag:e.val()})}else l(),b&&b(0);$.isFunction(window.render_recommend_groups)&&render_recommend_groups(e.val()),m()}function s(e){e.source=t.source||"",$.get(x,e).done(function(t){e.tag?t.sub_tags?c(t.sub_tags,"sub_tag"):l():c(t.tags,"tag")})}function c(t,e){var a,n="";"tag"===e?F.empty():"sub_tag"===e&&(M.empty(),t?A.find(".sub-tags").show().find("strong").text(A.find("[name=tag][checked]").val()):A.find(".sub-tags").hide()),$.each(t,function(t,a){n+=I({val:a,type:e,custom:!1})}),"tag"===e?($(n).appendTo(F),C.tag?(a=F.find("input[value="+C.tag+"]"),a.length?o(a):(a=$(I({val:C.tag,type:"tag",custom:!1})).appendTo(F),o($(a).find("input")))):o(F.find("input:first"))):"sub_tag"===e&&($(n).appendTo(M),o(C.sub_tag?M.find("input[value="+C.sub_tag+"]"):M.find("input:first"))),B=W.height()}function l(e){var a=D.serialize();T=$.get(j,a),t.hashbang&&(window.location.hash="!"+a),z.show().text("载入中..."),T.done(function(t){var a=t.subjects.length;k?a?(O.remove("p.empty"),v.show(),r(t.subjects)):(v.hide(),O.find("p.empty").length||O.append('<p class="empty">未找到相关影片</p>')):a||S.find(".item").length?d(t.subjects):(S.html("<p>未找到相关影片</p>"),z.hide()),a>=y?z.show().text("加载更多"):z.hide(),$.isFunction(e)&&e()})}function d(t,e){var a,n=A.find("[name='tag']:checked").val();t.length?($.each(t,function(t,e){e.tag=n,a+=Q(e)}),$(a).appendTo(S)):(S.html("<p>未找到相关影片</p>"),z.hide())}function r(t){var e=A.find("[name='tag']:checked").val();if(t.length){var a="";k.pageCount=Math.ceil(t.length/k.pageLimit),$.each(t,function(t,n){n.tag=e,a+=Q(n);var i=t+1;i%k.pageLimit===0&&(v.find('.slide-page[data-index="'+(i/k.pageLimit-1)+'"]').html(a),a="")})}else v.html("<p>未找到相关影片</p>")}function f(t){if("pending"!=T.state()){var e=$(t.currentTarget),a=S.find(".item").length,n=e.offset().top-5;A.find("[name=page_start]").val(a),l(function(){setTimeout(function(){$("html,body").animate({scrollTop:n-B},500)},300)})}}function p(e){if("True"===t.is_mobile)return fasle;var a=$(e.currentTarget),n=a.data("info"),i=a.offset(),o=a.data("id"),s=a.data("isnew");clearTimeout(g),g=setTimeout(function(){q.css({display:"block",top:i.top,left:i.left+a.width()}).empty(),n?$(R(n)).appendTo(q):$.get(H,{subject_id:o}).done(function(t){0===t.r&&(t.subject.is_new=s,t.subject.tag=A.find("[name='tag']:checked").val(),n=t.subject,a.data("info",n),$(R(n)).appendTo(q))})},600)}function u(t){$(t.target);clearTimeout(g),q.css({display:"none"})}function m(){var t=A.find(".more-link");if(0!==t.length){var e=D.find('[name="type"]').val(),a=D.find('[name="tag"]:checked').val(),n=t.attr("href").replace(/#.*$/,""),i=n+"#!type="+e+"&tag="+encodeURIComponent(a);t.attr("href",i)}}function h(){function t(t){if(!a){a=!0;var e=k.pageCount-1;t=t===-1?e:t,t=t===e+1?0:t,i.find(".dot").removeClass("activate").eq(t).addClass("activate"),0===w&&t===e?o.css({left:-(k.pageCount+1)*k.slideWidth}):w===e&&0===t&&o.css({left:0}),o.animate({left:-(t+1)*k.slideWidth},n,function(){a=!1}),w=t}}if(k){k.slideWidth=k.slideWidth||O.innerWidth()+18,k.slideHeight=k.slideHeight||518;var e=k.pageLimit*k.pageCount,a=!1,n=600;A.addClass("slide-mode"),D.find("[name=page_limit]").val(e),v=$(U(k)).appendTo(O.html(""));var i=v.find(".slide-ctrl"),o=v.find(".slide-wrapper");i.on("click",".btn-prev",function(e){t(w-1)}).on("click",".btn-next",function(e){t(w+1)}).on("click",".dot",function(e){var a=+$(e.target).data("index");t(a)}),b=t,t(0)}}var g,v,b,k=t.slide,y=k?0:20,w=0,C={},T=$.Deferred().resolve(),x="/j/search_tags",j="/j/search_subjects",H="/j/subject_abstract",A=t.selector?$(t.selector):$(".gaia"),D=A.find(".gaia_frm"),W=A.find(".fliter-wp"),L=A.find(".fliter-placeholder"),F=A.find(".tag-list"),M=A.find(".sub-tag-list"),O=A.find(".list-wp"),S=A.find(".list"),q=A.find(".detail-pop"),z=A.find(".more"),I=_.template($("#tag-tmpl").html()),Q=_.template($("#subject-tmpl").html()),R=_.template($("#subject-info-tmpl").html()),U=_.template($("#gaia-slide-tmpl").html()),B=0;$(window).on("scroll",function(){var e=S.height(),a=S.offset().top,n=$("body").scrollTop(),i=a-n;i<0&&Math.abs(i)<e&&t.fixFilter?W.hasClass("fliter-fix")||(L.css("height",B),W.addClass("fliter-fix").css({top:"-400px"}).animate({top:-($(".fliter-fix").outerHeight()-30)},300).find(".fliter-handle").text("当前选择："+F.find(".activate").text())):(L.css("height",0),W.removeClass("fliter-fix"))}),A.on("click","h2 [data-type]",e).on("click",".custom-btn",a).on("click",".custom-frm button",n).on("click","label .remove",i).on("click",".more",f).on("mouseover",".cover-wp",p).on("mouseout",".cover-wp",u).on("mouseover",".detail-pop",function(){$(this).show()}).on("mouseout",".detail-pop",function(){$(this).hide()}).on("click",".fliter-fix label input",function(){var t=A.offset().top;setTimeout(function(){$("html,body").animate({scrollTop:t},500)},10)}).on("mouseover",".fliter-fix",function(t){W.animate({top:0},100)}).on("mouseout",".fliter-fix",function(t){$(t.relatedTarget).isChildAndSelfOf(W)||W.animate({top:-($(this).outerHeight()-30)},100)}).on("click","label input",function(t){var e=$(this);return"watched"!==e.attr("name")||e.hasClass("me")?void o(e):(t.preventDefault(),e.removeAttr("checked"),$(".login-tip").slideDown("fast"),!1)}),A.on("mousedown",".a_collect_btn",function(){var t="true"===$("[name=islogin]").val()||A.find("[name=watched]").hasClass("me");t?load_event_monitor(".detail-pop"):account_pop.open("login","http://movie.douban.com/?tag_search=true")}),function(){var e=window.location.href.split("#!")[1],a=t.type?t.type:"movie";e&&(C=$.deparam(e),C.type&&(a=C.type),C.sort?A.find("[name=sort][value="+C.sort+"]").attr("checked","checked"):A.find("[name=sort][value=recommend]").attr("checked","checked"),"on"===C.watched&&A.find("[name=watched]").attr("checked","checked"),"on"===C.playable&&A.find("[name=playable]").attr("checked","checked")),h(),A.find("[data-type="+a+"]").trigger("click")}()}if(t instanceof Array){if(t.length!==$(".gaia").length)try{console.error("gaiaConfig count doesn't match .gaia class count")}catch(t){}for(var a=0;a<t.length;a++)e(t[a])}else e(t)}(gaiaConfig);